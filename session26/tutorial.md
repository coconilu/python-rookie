# Session26: 项目需求分析与设计

## 1. 需求工程基础

### 1.1 什么是需求工程

需求工程是软件开发过程中最关键的阶段之一，它涉及：
- **需求获取**：从利益相关者那里收集需求
- **需求分析**：理解和建模需求
- **需求规格说明**：文档化需求
- **需求验证**：确保需求正确性
- **需求管理**：管理需求变更

### 1.2 需求的类型

#### 功能性需求（Functional Requirements）
描述系统应该做什么：
- 用户登录功能
- 商品搜索功能
- 订单处理功能
- 支付处理功能

#### 非功能性需求（Non-functional Requirements）
描述系统应该如何工作：
- **性能需求**：响应时间 < 2秒
- **可用性需求**：系统可用性 99.9%
- **安全性需求**：数据加密传输
- **可扩展性需求**：支持10万并发用户

## 2. 需求收集技术

### 2.1 访谈法

```python
# 访谈问题模板
interview_questions = {
    "业务背景": [
        "请描述您的业务流程",
        "目前遇到的主要问题是什么？",
        "期望通过系统解决什么问题？"
    ],
    "功能需求": [
        "系统需要提供哪些核心功能？",
        "用户的典型使用场景是什么？",
        "数据处理的流程是怎样的？"
    ],
    "性能需求": [
        "预期的用户数量是多少？",
        "对响应时间有什么要求？",
        "数据量大概有多大？"
    ]
}
```

### 2.2 问卷调查法

```python
# 用户需求调查问卷示例
user_survey = {
    "基本信息": {
        "年龄段": ["18-25", "26-35", "36-45", "46+"],
        "职业": ["学生", "上班族", "自由职业", "其他"],
        "技术水平": ["初级", "中级", "高级"]
    },
    "使用习惯": {
        "购物频率": ["每天", "每周", "每月", "偶尔"],
        "设备偏好": ["手机", "电脑", "平板", "都用"],
        "支付方式": ["支付宝", "微信", "银行卡", "其他"]
    },
    "功能期望": {
        "最重要功能": ["搜索", "推荐", "比价", "评价"],
        "希望新增功能": "开放式回答"
    }
}
```

### 2.3 观察法

观察用户的实际操作行为，发现隐性需求：

```python
# 用户行为观察记录
user_behavior_log = {
    "用户ID": "user_001",
    "观察时间": "2024-01-15 14:30:00",
    "操作序列": [
        {"时间": "14:30:05", "操作": "打开首页", "耗时": "2s"},
        {"时间": "14:30:07", "操作": "搜索商品", "耗时": "15s"},
        {"时间": "14:30:22", "操作": "浏览商品详情", "耗时": "30s"},
        {"时间": "14:30:52", "操作": "比较价格", "耗时": "45s"}
    ],
    "痛点发现": [
        "搜索结果不够精准",
        "价格比较功能不明显",
        "商品图片加载慢"
    ]
}
```

## 3. 用例分析

### 3.1 用例图设计

用例图描述系统功能和参与者之间的关系：

```python
# 在线商城用例定义
ecommerce_use_cases = {
    "参与者": {
        "顾客": ["浏览商品", "搜索商品", "加入购物车", "下单", "支付", "查看订单"],
        "商家": ["管理商品", "处理订单", "查看销售报表", "客户服务"],
        "管理员": ["用户管理", "商品审核", "系统监控", "数据分析"],
        "支付系统": ["处理支付", "退款处理"]
    },
    "用例关系": {
        "包含关系": {
            "下单": ["验证库存", "计算价格", "生成订单"]
        },
        "扩展关系": {
            "支付": ["使用优惠券", "积分抵扣"]
        }
    }
}
```

### 3.2 用例规约

详细描述每个用例的执行流程：

```python
# 用例规约示例：用户登录
login_use_case = {
    "用例名称": "用户登录",
    "参与者": "顾客",
    "前置条件": "用户已注册账号",
    "后置条件": "用户成功登录系统",
    "主要流程": [
        "1. 用户访问登录页面",
        "2. 用户输入用户名和密码",
        "3. 系统验证用户凭据",
        "4. 系统创建用户会话",
        "5. 系统跳转到用户主页"
    ],
    "异常流程": {
        "3a. 用户名或密码错误": [
            "3a1. 系统显示错误信息",
            "3a2. 返回步骤2"
        ],
        "3b. 账号被锁定": [
            "3b1. 系统显示账号锁定信息",
            "3b2. 提供账号解锁方式"
        ]
    },
    "业务规则": [
        "密码错误3次后锁定账号",
        "会话超时时间为30分钟"
    ]
}
```

## 4. 系统架构设计

### 4.1 分层架构

```python
# 系统架构定义
system_architecture = {
    "表现层": {
        "Web前端": ["React", "Vue.js", "HTML/CSS/JS"],
        "移动端": ["React Native", "Flutter", "原生App"],
        "管理后台": ["Admin Dashboard"]
    },
    "业务逻辑层": {
        "用户服务": ["注册", "登录", "个人信息管理"],
        "商品服务": ["商品管理", "库存管理", "价格管理"],
        "订单服务": ["订单创建", "订单处理", "订单查询"],
        "支付服务": ["支付处理", "退款处理"]
    },
    "数据访问层": {
        "ORM框架": "SQLAlchemy",
        "数据库连接池": "连接池管理",
        "缓存层": "Redis"
    },
    "数据存储层": {
        "关系数据库": "PostgreSQL",
        "缓存数据库": "Redis",
        "文件存储": "云存储服务"
    }
}
```

### 4.2 微服务架构

```python
# 微服务架构设计
microservices_architecture = {
    "API网关": {
        "功能": ["路由", "认证", "限流", "监控"],
        "技术栈": "Kong/Nginx"
    },
    "核心服务": {
        "用户服务": {
            "端口": 8001,
            "数据库": "user_db",
            "API": ["/api/users", "/api/auth"]
        },
        "商品服务": {
            "端口": 8002,
            "数据库": "product_db",
            "API": ["/api/products", "/api/categories"]
        },
        "订单服务": {
            "端口": 8003,
            "数据库": "order_db",
            "API": ["/api/orders", "/api/cart"]
        },
        "支付服务": {
            "端口": 8004,
            "数据库": "payment_db",
            "API": ["/api/payments", "/api/refunds"]
        }
    },
    "基础设施": {
        "服务发现": "Consul",
        "配置中心": "Apollo",
        "消息队列": "RabbitMQ",
        "监控系统": "Prometheus + Grafana"
    }
}
```

## 5. 数据库设计

### 5.1 概念模型设计

```python
# 实体关系模型
entity_relationship_model = {
    "实体": {
        "用户": {
            "属性": ["用户ID", "用户名", "邮箱", "密码", "注册时间"],
            "主键": "用户ID"
        },
        "商品": {
            "属性": ["商品ID", "商品名称", "价格", "库存", "分类ID"],
            "主键": "商品ID"
        },
        "订单": {
            "属性": ["订单ID", "用户ID", "订单时间", "总金额", "状态"],
            "主键": "订单ID"
        },
        "订单项": {
            "属性": ["订单项ID", "订单ID", "商品ID", "数量", "单价"],
            "主键": "订单项ID"
        }
    },
    "关系": {
        "用户-订单": "一对多",
        "订单-订单项": "一对多",
        "商品-订单项": "一对多"
    }
}
```

### 5.2 逻辑模型设计

```python
# 数据库表结构设计
database_schema = {
    "users": {
        "字段": {
            "id": "SERIAL PRIMARY KEY",
            "username": "VARCHAR(50) UNIQUE NOT NULL",
            "email": "VARCHAR(100) UNIQUE NOT NULL",
            "password_hash": "VARCHAR(255) NOT NULL",
            "created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP",
            "updated_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        },
        "索引": ["username", "email"]
    },
    "products": {
        "字段": {
            "id": "SERIAL PRIMARY KEY",
            "name": "VARCHAR(200) NOT NULL",
            "description": "TEXT",
            "price": "DECIMAL(10,2) NOT NULL",
            "stock": "INTEGER DEFAULT 0",
            "category_id": "INTEGER REFERENCES categories(id)",
            "created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        },
        "索引": ["name", "category_id", "price"]
    },
    "orders": {
        "字段": {
            "id": "SERIAL PRIMARY KEY",
            "user_id": "INTEGER REFERENCES users(id)",
            "total_amount": "DECIMAL(10,2) NOT NULL",
            "status": "VARCHAR(20) DEFAULT 'pending'",
            "created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        },
        "索引": ["user_id", "status", "created_at"]
    }
}
```

## 6. 接口设计

### 6.1 RESTful API设计

```python
# API接口规范
api_specification = {
    "用户管理": {
        "POST /api/users/register": {
            "描述": "用户注册",
            "请求体": {
                "username": "string",
                "email": "string",
                "password": "string"
            },
            "响应": {
                "201": {"message": "注册成功", "user_id": "integer"},
                "400": {"error": "参数错误"},
                "409": {"error": "用户已存在"}
            }
        },
        "POST /api/users/login": {
            "描述": "用户登录",
            "请求体": {
                "username": "string",
                "password": "string"
            },
            "响应": {
                "200": {"token": "string", "expires_in": "integer"},
                "401": {"error": "认证失败"}
            }
        }
    },
    "商品管理": {
        "GET /api/products": {
            "描述": "获取商品列表",
            "查询参数": {
                "page": "integer",
                "size": "integer",
                "category": "string",
                "keyword": "string"
            },
            "响应": {
                "200": {
                    "products": "array",
                    "total": "integer",
                    "page": "integer",
                    "size": "integer"
                }
            }
        }
    }
}
```

### 6.2 API文档生成

```python
# 使用OpenAPI规范
from flask import Flask
from flask_restx import Api, Resource, fields

app = Flask(__name__)
api = Api(app, doc='/docs/')

# 定义数据模型
user_model = api.model('User', {
    'id': fields.Integer(required=True, description='用户ID'),
    'username': fields.String(required=True, description='用户名'),
    'email': fields.String(required=True, description='邮箱')
})

register_model = api.model('Register', {
    'username': fields.String(required=True, description='用户名'),
    'email': fields.String(required=True, description='邮箱'),
    'password': fields.String(required=True, description='密码')
})

@api.route('/users/register')
class UserRegister(Resource):
    @api.expect(register_model)
    @api.marshal_with(user_model)
    def post(self):
        """用户注册"""
        pass
```

## 7. 项目计划制定

### 7.1 工作分解结构（WBS）

```python
# 项目工作分解
project_wbs = {
    "1. 项目启动": {
        "1.1 需求调研": ["用户访谈", "竞品分析", "需求文档"],
        "1.2 技术选型": ["架构设计", "技术评估", "环境搭建"],
        "1.3 团队组建": ["人员招募", "角色分工", "开发规范"]
    },
    "2. 系统设计": {
        "2.1 架构设计": ["系统架构", "数据库设计", "接口设计"],
        "2.2 UI设计": ["原型设计", "视觉设计", "交互设计"],
        "2.3 详细设计": ["模块设计", "算法设计", "安全设计"]
    },
    "3. 开发实施": {
        "3.1 后端开发": ["用户模块", "商品模块", "订单模块", "支付模块"],
        "3.2 前端开发": ["页面开发", "组件开发", "状态管理"],
        "3.3 集成测试": ["单元测试", "接口测试", "系统测试"]
    },
    "4. 部署上线": {
        "4.1 环境准备": ["服务器配置", "数据库部署", "域名配置"],
        "4.2 系统部署": ["代码部署", "数据迁移", "性能调优"],
        "4.3 上线验收": ["功能验收", "性能测试", "安全测试"]
    }
}
```

### 7.2 进度计划

```python
# 项目进度计划
project_schedule = {
    "项目周期": "12周",
    "里程碑": {
        "第2周": "需求分析完成",
        "第4周": "系统设计完成",
        "第8周": "核心功能开发完成",
        "第10周": "系统测试完成",
        "第12周": "项目上线"
    },
    "详细计划": {
        "第1-2周": {
            "任务": "需求分析与设计",
            "交付物": ["需求规格说明书", "系统架构文档"],
            "人员": ["产品经理", "架构师"]
        },
        "第3-4周": {
            "任务": "详细设计",
            "交付物": ["数据库设计文档", "接口设计文档", "UI设计稿"],
            "人员": ["架构师", "UI设计师", "前端工程师"]
        },
        "第5-8周": {
            "任务": "开发实施",
            "交付物": ["后端服务", "前端页面", "数据库脚本"],
            "人员": ["后端工程师", "前端工程师", "测试工程师"]
        }
    }
}
```

### 7.3 风险管理

```python
# 项目风险识别与应对
risk_management = {
    "技术风险": {
        "风险描述": "新技术学习成本高",
        "概率": "中",
        "影响": "高",
        "应对策略": ["提前技术调研", "安排技术培训", "准备备选方案"]
    },
    "进度风险": {
        "风险描述": "开发进度延期",
        "概率": "高",
        "影响": "高",
        "应对策略": ["合理估算工作量", "增加人员投入", "调整功能范围"]
    },
    "质量风险": {
        "风险描述": "系统质量不达标",
        "概率": "中",
        "影响": "高",
        "应对策略": ["制定质量标准", "加强代码审查", "完善测试流程"]
    },
    "人员风险": {
        "风险描述": "关键人员离职",
        "概率": "低",
        "影响": "高",
        "应对策略": ["知识文档化", "交叉培训", "人员备份"]
    }
}
```

## 8. 需求管理

### 8.1 需求跟踪矩阵

```python
# 需求跟踪矩阵
requirement_traceability = {
    "REQ-001": {
        "需求描述": "用户注册功能",
        "优先级": "高",
        "状态": "已实现",
        "设计文档": "DOC-001",
        "测试用例": "TC-001",
        "代码模块": "user_service.py"
    },
    "REQ-002": {
        "需求描述": "商品搜索功能",
        "优先级": "高",
        "状态": "开发中",
        "设计文档": "DOC-002",
        "测试用例": "TC-002",
        "代码模块": "search_service.py"
    },
    "REQ-003": {
        "需求描述": "推荐系统",
        "优先级": "中",
        "状态": "待开发",
        "设计文档": "DOC-003",
        "测试用例": "TC-003",
        "代码模块": "recommendation_service.py"
    }
}
```

### 8.2 需求变更管理

```python
# 需求变更记录
requirement_changes = {
    "变更编号": "CR-001",
    "变更日期": "2024-01-20",
    "变更类型": "功能增加",
    "变更描述": "增加微信登录功能",
    "变更原因": "用户反馈需要更便捷的登录方式",
    "影响分析": {
        "工作量": "3人天",
        "进度影响": "延期1天",
        "成本影响": "增加5000元",
        "风险评估": "低风险"
    },
    "审批状态": "已批准",
    "实施计划": "第6周实施"
}
```

## 9. 质量保证

### 9.1 质量标准

```python
# 质量标准定义
quality_standards = {
    "功能质量": {
        "功能完整性": "100%需求实现",
        "功能正确性": "核心功能零缺陷",
        "功能适用性": "用户满意度>90%"
    },
    "性能质量": {
        "响应时间": "页面加载<2秒",
        "并发处理": "支持1000并发用户",
        "资源利用": "CPU使用率<80%"
    },
    "可靠性质量": {
        "系统可用性": "99.9%",
        "故障恢复": "<5分钟",
        "数据完整性": "零数据丢失"
    },
    "安全质量": {
        "身份认证": "多因子认证",
        "数据加密": "HTTPS传输",
        "访问控制": "基于角色的权限控制"
    }
}
```

### 9.2 评审检查单

```python
# 需求评审检查单
requirement_review_checklist = {
    "完整性检查": [
        "所有功能需求是否已定义？",
        "所有非功能需求是否已定义？",
        "所有接口需求是否已定义？",
        "所有约束条件是否已说明？"
    ],
    "正确性检查": [
        "需求描述是否准确？",
        "需求是否与业务目标一致？",
        "需求之间是否存在冲突？",
        "需求是否可测试？"
    ],
    "可行性检查": [
        "技术实现是否可行？",
        "时间安排是否合理？",
        "资源配置是否充足？",
        "成本预算是否合理？"
    ],
    "一致性检查": [
        "需求表述是否一致？",
        "术语使用是否统一？",
        "格式规范是否统一？",
        "版本信息是否正确？"
    ]
}
```

## 10. 总结

### 10.1 关键要点

1. **需求工程是项目成功的基础**
   - 充分的需求调研
   - 准确的需求分析
   - 规范的需求文档

2. **系统设计要考虑全面**
   - 功能架构设计
   - 技术架构设计
   - 数据架构设计

3. **项目管理要科学规范**
   - 合理的进度计划
   - 有效的风险管理
   - 严格的质量控制

### 10.2 最佳实践

1. **需求分析最佳实践**
   - 多种方法结合使用
   - 持续的需求验证
   - 及时的需求更新

2. **设计文档最佳实践**
   - 分层次的设计文档
   - 图文并茂的表达方式
   - 版本化的文档管理

3. **项目管理最佳实践**
   - 敏捷开发方法
   - 持续集成部署
   - 定期的项目回顾

### 10.3 常见问题

1. **需求不明确**
   - 解决方案：多轮需求澄清
   - 预防措施：需求原型验证

2. **设计过度复杂**
   - 解决方案：简化设计方案
   - 预防措施：遵循设计原则

3. **进度控制困难**
   - 解决方案：细化任务分解
   - 预防措施：定期进度检查

## 扩展阅读

1. **软件工程经典书籍**
   - 《软件工程：实践者的研究方法》
   - 《人月神话》
   - 《代码大全》

2. **需求工程专业资料**
   - 《需求工程：软件需求的分析与规格说明》
   - 《用户故事与敏捷方法》
   - 《软件需求》

3. **项目管理参考资料**
   - 《项目管理知识体系指南》
   - 《敏捷项目管理》
   - 《Scrum敏捷软件开发》